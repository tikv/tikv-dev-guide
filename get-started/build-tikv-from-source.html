<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Build TiKV from Source - TiKV Development Guide</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> TiKV Development Guide</a></li><li class="chapter-item expanded "><a href="../get-started/intro.html"><strong aria-hidden="true">2.</strong> Get Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../get-started/build-tikv-from-source.html" class="active"><strong aria-hidden="true">2.1.</strong> Build TiKV from Source</a></li><li class="chapter-item expanded "><a href="../get-started/import-tikv-into-an-ide.html"><strong aria-hidden="true">2.2.</strong> Import TiKV into an IDE</a></li><li class="chapter-item expanded "><a href="../get-started/write-and-run-unit-tests.html"><strong aria-hidden="true">2.3.</strong> Write and Run Unit Tests</a></li><li class="chapter-item expanded "><a href="../get-started/debug-and-profile.html"><strong aria-hidden="true">2.4.</strong> Debug and Profile</a></li><li class="chapter-item expanded "><a href="../get-started/submit-a-pull-request.html"><strong aria-hidden="true">2.5.</strong> Submit a Pull Request</a></li></ol></li><li class="chapter-item expanded "><a href="../contribute-to-tikv/intro.html"><strong aria-hidden="true">3.</strong> Contribute to TiKV</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../contribute-to-tikv/community-guideline.html"><strong aria-hidden="true">3.1.</strong> Community Guideline</a></li><li class="chapter-item expanded "><a href="../contribute-to-tikv/committer-guide.html"><strong aria-hidden="true">3.2.</strong> Committer Guide</a></li><li class="chapter-item expanded "><a href="../contribute-to-tikv/report-a-bug.html"><strong aria-hidden="true">3.3.</strong> Report a Bug</a></li><li class="chapter-item expanded "><a href="../contribute-to-tikv/contribute-code.html"><strong aria-hidden="true">3.4.</strong> Contribute code</a></li><li class="chapter-item expanded "><a href="../contribute-to-tikv/review-a-pull-request.html"><strong aria-hidden="true">3.5.</strong> Review a Pull Request</a></li><li class="chapter-item expanded "><a href="../contribute-to-tikv/request-for-comments.html"><strong aria-hidden="true">3.6.</strong> Request for Comments</a></li><li class="chapter-item expanded "><a href="../contribute-to-tikv/code-style-and-quality-guide.html"><strong aria-hidden="true">3.7.</strong> Code Style and Quality Guide</a></li><li class="chapter-item expanded "><a href="../contribute-to-tikv/write-document.html"><strong aria-hidden="true">3.8.</strong> Write document</a></li></ol></li><li class="chapter-item expanded "><a href="../understanding-tikv/intro.html"><strong aria-hidden="true">4.</strong> Understanding TiKV</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../understanding-tikv/overview/intro.html"><strong aria-hidden="true">4.1.</strong> Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../understanding-tikv/overview/raw-kv.html"><strong aria-hidden="true">4.1.1.</strong> Raw KV</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/overview/transaction-kv.html"><strong aria-hidden="true">4.1.2.</strong> Transaction KV</a></li></ol></li><li class="chapter-item expanded "><a href="../understanding-tikv/scalability/intro.html"><strong aria-hidden="true">4.2.</strong> Scalability</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../understanding-tikv/scalability/region.html"><strong aria-hidden="true">4.2.1.</strong> Region</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/scalability/scheduling.html"><strong aria-hidden="true">4.2.2.</strong> Scheduling</a></li></ol></li><li class="chapter-item expanded "><a href="../understanding-tikv/high-availability/intro.html"><strong aria-hidden="true">4.3.</strong> High Availability</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../understanding-tikv/high-availability/raft/intro.html"><strong aria-hidden="true">4.3.1.</strong> Raft</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../understanding-tikv/high-availability/raft/raft-rs.html"><strong aria-hidden="true">4.3.1.1.</strong> raft-rs</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/high-availability/raft/leader-lease.html"><strong aria-hidden="true">4.3.1.2.</strong> Leader Lease</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/high-availability/raft/hibernate-region.html"><strong aria-hidden="true">4.3.1.3.</strong> Hibernate Region</a></li></ol></li><li class="chapter-item expanded "><a href="../understanding-tikv/high-availability/multi-raft/intro.html"><strong aria-hidden="true">4.3.2.</strong> Multi-Raft</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../understanding-tikv/high-availability/multi-raft/split.html"><strong aria-hidden="true">4.3.2.1.</strong> Split</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/high-availability/multi-raft/merge.html"><strong aria-hidden="true">4.3.2.2.</strong> Merge</a></li></ol></li><li class="chapter-item expanded "><a href="../understanding-tikv/high-availability/raftstore/intro.html"><strong aria-hidden="true">4.3.3.</strong> RaftStore</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../understanding-tikv/high-availability/raftstore/actor-model.html"><strong aria-hidden="true">4.3.3.1.</strong> Actor Model</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/high-availability/raftstore/fsm.html"><strong aria-hidden="true">4.3.3.2.</strong> FSM</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../understanding-tikv/transaction/intro.html"><strong aria-hidden="true">4.4.</strong> Transaction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../understanding-tikv/transaction/percolator/intro.html"><strong aria-hidden="true">4.4.1.</strong> Percolator</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../understanding-tikv/transaction/percolator/tso.html"><strong aria-hidden="true">4.4.1.1.</strong> TSO</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/transaction/percolator/encode.html"><strong aria-hidden="true">4.4.1.2.</strong> Encode</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/transaction/percolator/command.html"><strong aria-hidden="true">4.4.1.3.</strong> Command</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/transaction/percolator/latch-and-scheduler.html"><strong aria-hidden="true">4.4.1.4.</strong> Latch and Scheduler</a></li></ol></li><li class="chapter-item expanded "><a href="../understanding-tikv/transaction/pessimistic-transaction.html"><strong aria-hidden="true">4.4.2.</strong> Pessimistic Transaction</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/transaction/async-commit.html"><strong aria-hidden="true">4.4.3.</strong> Async Commit</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/transaction/1pc.html"><strong aria-hidden="true">4.4.4.</strong> 1PC</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/transaction/stale-read.html"><strong aria-hidden="true">4.4.5.</strong> Stale Read</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/transaction/cdc.html"><strong aria-hidden="true">4.4.6.</strong> CDC</a></li></ol></li><li class="chapter-item expanded "><a href="../understanding-tikv/storage/intro.html"><strong aria-hidden="true">4.5.</strong> Storage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../understanding-tikv/storage/rocksdb.html"><strong aria-hidden="true">4.5.1.</strong> RocksDB</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/storage/encode.html"><strong aria-hidden="true">4.5.2.</strong> Encode</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/storage/import-and-export.html"><strong aria-hidden="true">4.5.3.</strong> Import and Export</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/storage/io-rate-limiter.html"><strong aria-hidden="true">4.5.4.</strong> IO Rate Limiter</a></li></ol></li><li class="chapter-item expanded "><a href="../understanding-tikv/coprocessor/intro.html"><strong aria-hidden="true">4.6.</strong> Coprocessor</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../understanding-tikv/coprocessor/tidb-expression-executor.html"><strong aria-hidden="true">4.6.1.</strong> TiDB Expression Executor</a></li><li class="chapter-item expanded "><a href="../understanding-tikv/coprocessor/coprocessor-plugin.html"><strong aria-hidden="true">4.6.2.</strong> Coprocessor Plugin</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">TiKV Development Guide</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/tisonkun/tikv-dev-guide" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="build-tikv-from-source"><a class="header" href="#build-tikv-from-source">Build TiKV from Source</a></h1>
<p>TiKV is mostly written in Rust, and has components written in C++ (RocksDB, gRPC). We are currently using the Rust <a href="https://rust-lang.github.io/rustup/concepts/toolchains.html">nightly toolchain</a>. To provide consistency, we use linters and automated formatting tools.</p>
<h3 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h3>
<p>To build TiKV you'll need to at least have the following installed:</p>
<ul>
<li><a href="https://git-scm.com/"><code>git</code></a> - Version control</li>
<li>[<code>rustup</code>] - Rust installer and toolchain manager</li>
<li><a href="https://www.gnu.org/software/make/"><code>make</code></a> - Build tool (run common workflows)</li>
<li><a href="https://cmake.org/"><code>cmake</code></a> - Build tool (required for [gRPC])</li>
<li><a href="https://www.gnu.org/software/gawk/manual/gawk.html"><code>awk</code></a> - Pattern scanning/processing language</li>
<li>C++ compiler - <a href="https://gcc.gnu.org/"><code>gcc</code></a> 4.9+ (required for [gRPC])</li>
</ul>
<p>If you are targeting platforms other than x86_64 linux, you'll also need:</p>
<ul>
<li><a href="http://releases.llvm.org/download.html"><code>llvm</code> and <code>clang</code></a> - Used to generate bindings for different platforms and build native libraries (required for grpcio, rocksdb).</li>
</ul>
<p><em>(Latest version of the above tools should work in most cases. When encountering any trouble of building TiKV, try upgrading to the latest. If it is not helped, do not hesitate to <a href="#ask-for-help">ask</a>.)</em></p>
<h3 id="getting-the-repository"><a class="header" href="#getting-the-repository">Getting the repository</a></h3>
<pre><code>git clone https://github.com/tikv/tikv.git
cd tikv
# Future instructions assume you are in this directory
</code></pre>
<h3 id="building-and-testing"><a class="header" href="#building-and-testing">Building and testing</a></h3>
<p>TiKV includes a <a href="https://github.com/tikv/tikv/blob/master/Makefile"><code>Makefile</code></a> that has common workflows and sets up a standard build environment. You can also use [<code>cargo</code>], as you do in many other Rust projects. To run <code>cargo</code> commands in the same environment as the <code>Makefile</code> to avoid re-compilations due to environment changes, you can prefix the command with <a href="https://github.com/tikv/tikv/blob/master/scripts/env"><code>scripts/env</code></a>, for example: <code>./scripts/env cargo build</code>.</p>
<p>Furthermore, when building by <code>make</code>, <code>cargo</code> is configured to use <a href="https://internals.rust-lang.org/t/evaluating-pipelined-rustc-compilation/10199">pipelined compilation</a> to increase the parallelism of the build. To turn on pipelining while using <code>cargo</code> directly, set environment variable <code>export CARGO_BUILD_PIPELINING=true</code>.</p>
<p>To build TiKV:</p>
<pre><code class="language-bash">make build
</code></pre>
<p>During interactive development, you may prefer using <code>cargo check</code>, which will parse, do borrow check, and lint your code, but not actually compile it:</p>
<pre><code class="language-bash">./scripts/env cargo check --all
</code></pre>
<p>It is particularly handy alongside <code>cargo-watch</code>, which runs a command each time you change a file.</p>
<pre><code class="language-bash">cargo install cargo-watch
cargo watch -s &quot;./scripts/env cargo check --all&quot;
</code></pre>
<p>When you're ready to test out your changes, use the <code>dev</code> task. It will format your codebase, build with <code>clippy</code> enabled, and run tests. In most case, this should be done without any failure before you create a Pull Request. Unfortunately, some tests will fail intermittently or can not pass on your platform. If you're unsure, just <a href="#ask-for-help">ask</a>!</p>
<pre><code class="language-bash">make dev
</code></pre>
<p>You can run the test suite alone, or just run a specific test:</p>
<pre><code class="language-bash"># Run the full suite
make test
# Run a specific test
./scripts/test $TESTNAME -- --nocapture
</code></pre>
<p>TiKV follows the Rust community coding style. We use <a href="https://github.com/rust-lang/rustfmt">rustfmt</a> and <a href="https://github.com/rust-lang/rust-clippy">clippy</a> to automatically format and lint our codes. Using these tools is included in our CI. They are also part of <code>make dev</code>, and you can run them alone:</p>
<pre><code class="language-bash"># Run Rustfmt
make format
# Run Clippy (note that some lints are ignored, so `cargo clippy` will give many false positives)
make clippy
</code></pre>
<p>See the <a href="https://github.com/rust-lang/rfcs/blob/master/style-guide/README.md">Rust Style Guide</a> and the <a href="https://rust-lang-nursery.github.io/api-guidelines/">Rust API Guidelines</a> for details on the conventions.</p>
<p>Please follow this style to make TiKV easy to review, maintain, and develop.</p>
<h3 id="build-for-debugging"><a class="header" href="#build-for-debugging">Build for Debugging</a></h3>
<p>To reduce compilation time, TiKV builds do not include full debugging information by default â€” <code>release</code> and <code>bench</code> builds include no debuginfo; <code>dev</code> and <code>test</code> builds include line numbers only. The easiest way to enable debuginfo is to precede build commands with <code>RUSTFLAGS=-Cdebuginfo=1</code> (for line numbers), or <code>RUSTFLAGS=-Cdebuginfo=2</code> (for full debuginfo). For example,</p>
<pre><code class="language-bash">RUSTFLAGS=-Cdebuginfo=2 make dev
RUSTFLAGS=-Cdebuginfo=2 ./scripts/env cargo build
</code></pre>
<h3 id="ask-for-help"><a class="header" href="#ask-for-help">Ask for help</a></h3>
<p>If you encounter any problem during your journey, do not hesitate to reach out on the <a href="https://internals.tidb.io/">TiDB Internals forum</a>.
[<code>rustup</code>]: https://rustup.rs/
[<code>cargo</code>]: https://doc.rust-lang.org/cargo/
[gRPC]: https://github.com/grpc/grpc
[rustfmt]: https://github.com/rust-lang/rustfmt
[clippy]: https://github.com/rust-lang/rust-clippy</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../get-started/intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../get-started/import-tikv-into-an-ide.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../get-started/intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../get-started/import-tikv-into-an-ide.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
